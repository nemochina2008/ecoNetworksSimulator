---
title: "Trophic Logistic Models"
author: "Stephen Gaito"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Trophic Logistic Model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
# Model equations

We base the equations used for the continuous time integration on two sources, the Rosenzweig-MacArthur multi-species model as discussed McCann[^1], and Predator-Prey models as discussed by Murray[^2]. In our case we are explicitly assuming multiple trophic layers, with multiple species in each "layer".

[^1]: "Food Webs" by Kevin S McCann, published by Princeton University press, 2012. See Chapter 7 "Food Chains and Omnivory", equations 7.2

[^2]: "Mathematical Biology" by J. D. Murray, published by Springer-Verlag, Biomathematics Texts, 1990. See Section 3.3 "Realistic Predator-Prey Models"

For any given species the rate of change of the (biomass of the) population depends on essentially four terms:

  1. growth terms coming from the consumption of some external energy source,
  2. growth terms coming from the consumption of some other species,
  3. decay terms coming from predation by some other species.
  4. decay terms coming from death by natural causes,

$$
\frac{dS_i}{dt} = 
  \text{growth}_{\text{energy}} + \text{growth}_{\text{consumption}} 
  - \text{decay}_{\text{predation}} - \text{decay}_{\text{natural}} 
$$

Let $\hat{S}$ denote the collection of all species. Let $\hat{S}^+_i$ and $\hat{S}^-_i$ denote the collection of species which are, respectively, consumed by or consume a given species $S_i$. For any base species, $S_i$, which only consumes some external energy, the set $\hat{S}^+_i$ will be empty. Conversely for a top predator, $S_j$, in any trophic consumption chain, the set $\hat{S}^-_j$ will also be empty. For any other species, these two sets will generally contain one or more species. For a given predator-prey or consumer-resource interaction between species, $S_c$ and $S_r$ respectively, we will have $S_c \in \hat{S}^-_r$ and $S_r \in \hat{S}^+_c$.

Using these symbols, we can state the rate of change for a given species, $S_i$ as:

$$
\frac{dS_i}{dt} =
  G_e(S_i) + G_c(\hat{S}^+_i)
  - D_p(\hat{S}^-_i) - D_n(S_i)
$$

For the growth from an external energy source, $G_e$, we assume a sigmoidal functional relationship with species density.  That is essentially exponential growth at low population densities with saturation at high population densities. We will assume that this sigmoidal functional relationship is given by the logistic growth equations. For decay by natural causes, $D_n$, we will assume simple linear decay. Hence, for species, $S_i$, we have the following two terms:

$$
\begin{align*}
G_e(S_i) & = & r_i * S_i * \left( 1 - \frac{S_i}{K_i} \right) \\
D_n(S_i) & = & m_i * S_i
\end{align*}
$$

Where $r_i$, $K_i$ and $m_i$ are the growth rate, carrying capacity and mortalitiy rates for species $S_i$. Note that for a base species, these two terms, $G_e$ and $D_n$, can be amalgamated into a single term by suitable adjustments of the growth rate and carrying capacity parameters.

Now consider a **predator species**, $S_i$. We again assume a sigmoidal functional relationship with species density, but this time we assume the saturation to be dependent upon the total density of the species the predator consumes. That is the preadtor's growth for a given attack saturates the greater the total attacks (over all prey species). So for the predator we model the $G_c$ term as:

$$
G_c(S_i) =
  \left( \sum_{j \in \hat{S}^+_i} e_{i,j} * a_{i,j} * S_j \right)
  * \frac{S_i}{ h_i + \sum_{j \in \hat{S}^+_i} a_{i,j} * S_j }
$$

Where $h_i$ is the half-saturation parameter for species $S_i$, and $e_{i,j}$ and $a_{i,j}$ are, respectively, the efficiency or conversion and attack rates of the predation of species $S_i$ on species $S_j$. For a given predator, the half-saturation parameter, $h_i$, can be normalized to $1$ by adjusting the efficiency or conversion rates, $e_{i,j}$ for the predator, $S_i$.

Now consider a **prey species**, $S_i$. We assume the decay due to predation, $D_p$, depends upon all predator species which consume $S_i$:

$$
D_p(S_i) = \sum_{j \in \hat{S}^-_i} a_{i,j} * S_i
  * \frac{S_j}{h_j + \sum_{k \in \hat{S}^+_j} a_{j,k} * S_k}
$$

Putting this all together, for a general species, $S_i$, which might be both a predator and a prey, we get:

$$
\begin{align*}
\frac{dS_i}{dt}
  & = & r_i * S_i * \left( 1 - \frac{S_i}{K_i} \right) \\
  &   &  + \left( \sum_{j \in \hat{S}^+_i} e_{i,j} * a_{i,j} * S_j \right)
          * \frac{S_i}{ h_i + \sum_{j \in \hat{S}^+_i} a_{i,j} * S_j } \\
  &   &  - \sum_{j \in \hat{S}^-_i} a_{i,j} * S_i
          * \frac{S_j}{h_j + \sum_{k \in \hat{S}^+_j} a_{j,k} * S_k} \\
  &   &  - m_i * S_i
\end{align*}
$$

This equation is usually simplified for three typical cases:

For a **base species**:

$$
\begin{align*}
\frac{dS_i}{dt}
  & = & r_i * S_i * \left( 1 - \frac{S_i}{K_i} \right) \\
  &   &  - \sum_{j \in \hat{S}^-_i} a_{i,j} * S_i
          * \frac{S_j}{h_j + \sum_{k \in \hat{S}^+_j} a_{j,k} * S_k}
\end{align*}
$$

For an **intermediate species** (both a predator and a prey) we have:

$$
\begin{align*}
\frac{dS_i}{dt}
  & = &  + \left( \sum_{j \in \hat{S}^+_i} e_{i,j} * a_{i,j} * S_j \right)
          * \frac{S_i}{ h_i + \sum_{j \in \hat{S}^+_i} a_{i,j} * S_j } \\
  &   &  - \sum_{j \in \hat{S}^-_i} a_{i,j} * S_i
          * \frac{S_j}{h_j + \sum_{k \in \hat{S}^+_j} a_{j,k} * S_k} \\
  &   &  - m_i * S_i
\end{align*}
$$

For a **top predator** we have:

$$
\begin{align*}
\frac{dS_i}{dt}
  & = &  + \left( \sum_{j \in \hat{S}^+_i} e_{i,j} * a_{i,j} * S_j \right)
          * \frac{S_i}{ h_i + \sum_{j \in \hat{S}^+_i} a_{i,j} * S_j } \\
  &   &  - m_i * S_i
\end{align*}
$$

# Specifying a model in R

```{r echo=FALSE}
library(ecoNetworksSimulator)
```

To build a given trophic model we begin by creating an empty species table and then adding the different species:

```{r}
species <- newSpeciesTable()
species <- addSpecies(species, 
  "resource1",
  growthRate=0.2,
  carryingCapacity=25)
species <- addSpecies(species, 
  "resource2",
  growthRate=0.2,
  carryingCapacity=25)
species <- addSpecies(species, 
  "consumer",
  mortality=0.2,
  halfSaturation=1)
species
```

Next we create an empty interactions table and then add some interactions:

```{r}
interactions <- newInteractionsTable()
interactions <- addInteraction(interactions,
  predator="consumer",
  prey="resource1",
  attackRate=0.1,
  conversionRate=0.35)
interactions <- addInteraction(interactions,
  predator="consumer",
  prey="resource2",
  attackRate=0.1,
  conversionRate=0.35)
interactions
```

now we assemble the species and interactions tables in to a model:

```{r}
r2c1 <- newModel(species=species, interactions=interactions)
r2c1
```

we can then get a LaTeX representation of our model

```{r eval=FALSE}
getLaTeX(r2c1) # NOT YET IMPLEMENTED
```

or the species interactions in an interactions *matrix* form

```{r eval=FALSE}
getInteractionsMatrix(r2c1) # NOT YET IMPLEMENTED
```

We might want to specify a random collection of models based upon individual species and interaction mean and standard deviations. To do this we can add species and interactions tables standard deviations tables to the model:

```{r}
speciesStd <- newSpeciesTable()
speciesStd <- addSpecies(speciesStd, 
  name="resource1",
  growthRate=0.01,
  carryingCapacity=5)
speciesStd <- addSpecies(speciesStd, 
  name="resource2",
  growthRate=0.01,
  carryingCapacity=5)
speciesStd <- addSpecies(speciesStd, 
  name="consumer",
  mortality=0.01,
  halfSaturation=0.0)
speciesStd
```

Next we create an empty interactions table and then add some interactions:

```{r}
interactionsStd <- newInteractionsTable()
interactionsStd <- addInteraction(interactionsStd,
  predator="consumer",
  prey="resource1",
  attackRate=0.01,
  conversionRate=0.1)
interactionsStd <- addInteraction(interactionsStd,
  predator="consumer",
  prey="resource2",
  attackRate=0.01,
  conversionRate=0.1)
interactionsStd
```

This time we can add all four tables to the model at once:

```{r}
r2c1var <- newNormalModel(
  species, speciesStd,
  interactions, interactionsStd
)
r2c1var
```

To get an individual model:

```{r eval=FALSE}
# r2c1 <- varyModel(r2c1var) # NOT YET IMPLEMENTED
```

